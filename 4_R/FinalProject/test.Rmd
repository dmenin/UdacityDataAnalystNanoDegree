```{r, echo=FALSE, include=FALSE}
setwd("C:/git/UdacityDataAnalystNanoDegree/4_R/FinalProject/")
df<-read.csv("wineQualityWhites.csv")
library(plyr)
library(dplyr)
library(sfsmisc)
library(reshape2 )
library(ggplot2)
library(gridExtra)
library (corrplot)
library(caret)
library(tree)

df<- df[!df$X == 2782, ]
df[,c("X")] <- list(NULL)

df$rating <- ifelse(df$quality <= 5, 'Bad', 
                    ifelse(df$quality <= 7, 'Average', 
                           ifelse(df$quality<=8,'Good', 
                                  'Excellent'
                           )
                    )
)

df$rating <- ordered(df$rating,levels = c('Bad', 'Average', 'Good', 'Excellent'))

df$quality <- as.factor(df$quality)

```


<p style='text-align: justify;'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Let's start the multivariable plotting by combining together all of the 5 variables we selected on the previous step. In order to make visualization more clear, and since our main question is what makes a wine "Good" (or bad), I will removed the "average" wines from the plots. Since we only have 5 Excellent wines, for the same aesthetic reason, I will consider all the Excellent wines as Good.
</p>

```{r, warning=FALSE, fig.width = 10, fig.height= 10, message=FALSE}
df2 <- subset(df, rating != 'Average')
df2[df2$rating == 'Excellent',]$rating <- 'Good'

p1<-ggplot(data = df2, aes(x = alcohol, y = volatile.acidity,color = rating)) +  geom_point() 
p2<-ggplot(data = df2, aes(x = alcohol, y = free.sulfur.dioxide,color = rating)) +  geom_point()  
p3<-ggplot(data = df2, aes(x = alcohol, y = chlorides,color = rating)) +  geom_point()  
p4<-ggplot(data = df2, aes(x = alcohol, y = pH,color = rating)) +  geom_point()  

p5<-ggplot(data = df2, aes(x = volatile.acidity, y = free.sulfur.dioxide, color = rating)) +  geom_point() 
p6<-ggplot(data = df2, aes(x = volatile.acidity, y = chlorides, color = rating)) +  geom_point()
p7<-ggplot(data = df2, aes(x = volatile.acidity, y = pH, color = rating)) +  geom_point()

p8<-ggplot(data = df2, aes(x = free.sulfur.dioxide, y = chlorides, color = rating)) +  geom_point()
p9<-ggplot(data = df2, aes(x = free.sulfur.dioxide, y = pH, color = rating)) +  geom_point()

p10<-ggplot(data = df2, aes(x = chlorides, y = pH, color = rating)) +  geom_point()

grid.arrange(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,ncol=2)
```


<p style='text-align: justify;'>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Looking at the 4 plots where alcohol appears we can clearly see that good wines are clustered together, for example, the majority of good wines seem to be on the 12-14 alcohol \ 0 to 100 free sulphur dioxide.  Can't seem to find such a strong clustering relationship on any of the other variable combination.
</p>


##Final Plots and Summary

###PLot 1 

**Relashionship between Density and Residual Sugar Colored By amount of alcohol**
```{r}
df$alcoholbucket <- cut(df$alcohol, c(8, 10, 12, 14.2))

ggplot(aes(x = density, y = residual.sugar, color = alcoholbucket), data = df) +
  geom_point() +
  geom_smooth(aes(group = 1), method = 'loess', formula = y ~ x, size = 0.5) +
  ggtitle("Relashionship between Density and Residual Sugar Colored By amount of alcohol") +
  theme(plot.title = element_text(face = "bold")) +
  xlim(c(0.9871, 1.001)) +
  xlab("density (g / cm^3)") +  
  ylim(c(0.6, 25)) +  
  ylab("Residual Sugar (g / dm^3)") +
  scale_color_brewer(palette = "Set2", name = "Alcohol Bucket (% by volume)")
```
<br>
<br>

###PLot 2
**Quality Trend Lines over volatile.acidity and alcohol for Good and Bad Wines**
```{r}
ggplot(df2, aes(alcohol,volatile.acidity)) +
  geom_point(aes(color=factor(rating))) + 
  stat_smooth(method = "lm", se=F, aes(color=factor(rating),group=rating), alpha=1) +
  ggtitle("Quality Trend Lines over volatile.acidity and alcohol for Good and Bad Wines")+
  theme(plot.title = element_text(face = "bold")) +
  xlab("Alcohol (% by volume)") +  
  ylab("Density (g / cm^3)") 
```
  
  
  
<!--
```{r}
fit <- tree(rating ~ alcohol + volatile.acidity + free.sulfur.dioxide + chlorides +  pH, data=df, method="class")
plot(fit)
text(fit, pretty=0, cex=0.6)

```
?tree

table(df$rating)

-->